# InfraSight-AI: Architecture & Design Document

## Executive Summary

InfraSight-AI is an AI-driven infrastructure intelligence platform that combines graph analytics, RAG (Retrieval-Augmented Generation), and agentic AI to transform IT operations and incident management for hosting services.

---

## 1. High-Level Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              INFRASIGHT-AI ARCHITECTURE                              │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                    PRESENTATION LAYER                                │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                         Gradio Web Interface                                 │    │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────────┐   │    │
│  │  │ Incident     │ │ Change Risk  │ │ Dependency   │ │ Knowledge        │   │    │
│  │  │ Analysis     │ │ Assessment   │ │ Visualizer   │ │ Discovery        │   │    │
│  │  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────────┘   │    │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────────┐   │    │
│  │  │ Anomaly      │ │ Capacity     │ │ Orphan       │ │ Chat             │   │    │
│  │  │ Detection    │ │ Prediction   │ │ Detection    │ │ Interface        │   │    │
│  │  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────────┘   │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                          │
                                          ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                    AGENTIC AI LAYER                                  │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                        LangChain Agent Orchestrator                          │    │
│  │  ┌──────────────────┐ ┌──────────────────┐ ┌──────────────────────────┐    │    │
│  │  │  RCA Agent       │ │ Change Risk      │ │ Remediation              │    │    │
│  │  │  ────────────    │ │ Agent            │ │ Recommendation Agent     │    │    │
│  │  │  • Graph Query   │ │ ────────────     │ │ ────────────────────     │    │    │
│  │  │  • Blast Radius  │ │ • Risk Scoring   │ │ • RAG Retrieval          │    │    │
│  │  │  • Root Cause    │ │ • Impact Calc    │ │ • Fix Recommendation     │    │    │
│  │  │    Inference     │ │ • Auto-Classify  │ │ • Workaround Suggest     │    │    │
│  │  └──────────────────┘ └──────────────────┘ └──────────────────────────┘    │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
│                                          │                                           │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                         Llama 3.2 via Ollama (Local LLM)                     │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                          │
                    ┌─────────────────────┴─────────────────────┐
                    ▼                                           ▼
┌───────────────────────────────────────┐   ┌───────────────────────────────────────┐
│          RAG PIPELINE                  │   │         GRAPH ANALYTICS ENGINE         │
│  ┌─────────────────────────────────┐  │   │  ┌─────────────────────────────────┐  │
│  │     Embedding Generator         │  │   │  │     Cypher Query Engine          │  │
│  │     (all-MiniLM-L6-v2)          │  │   │  │     ─────────────────────        │  │
│  └─────────────────────────────────┘  │   │  │     • Dependency Traversal       │  │
│  ┌─────────────────────────────────┐  │   │  │     • Path Analysis              │  │
│  │     Vector Search               │  │   │  │     • Centrality Metrics         │  │
│  │     (pgvector cosine)           │  │   │  └─────────────────────────────────┘  │
│  └─────────────────────────────────┘  │   │  ┌─────────────────────────────────┐  │
│  ┌─────────────────────────────────┐  │   │  │     Graph Algorithms             │  │
│  │     Context Builder             │  │   │  │     ─────────────────            │  │
│  │     (Chunk + Metadata)          │  │   │  │     • PageRank                   │  │
│  └─────────────────────────────────┘  │   │  │     • Community Detection        │  │
│                                        │   │  │     • Shortest Path              │  │
└───────────────────────────────────────┘   │  └─────────────────────────────────┘  │
                    │                        └───────────────────────────────────────┘
                    │                                           │
                    └─────────────────────┬─────────────────────┘
                                          ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                   DATA LAYER                                         │
│  ┌─────────────────────────────────────┐ ┌─────────────────────────────────────┐    │
│  │        PostgreSQL 15                 │ │          Neo4j                       │    │
│  │        ─────────────                 │ │          ─────                       │    │
│  │  ┌────────────────────────────────┐ │ │  ┌────────────────────────────────┐ │    │
│  │  │ Structured ITSM Data           │ │ │  │ CI Dependency Graph            │ │    │
│  │  │ • incidents                    │ │ │  │ • ConfigurationItem nodes      │ │    │
│  │  │ • problems                     │ │ │  │ • Service nodes                │ │    │
│  │  │ • changes                      │ │ │  │ • Application nodes            │ │    │
│  │  │ • configuration_items          │ │ │  │ • DEPENDS_ON relationships     │ │    │
│  │  │ • services                     │ │ │  │ • HOSTS relationships          │ │    │
│  │  │ • resolutions                  │ │ │  │ • AFFECTS relationships        │ │    │
│  │  └────────────────────────────────┘ │ │  └────────────────────────────────┘ │    │
│  │  ┌────────────────────────────────┐ │ │  ┌────────────────────────────────┐ │    │
│  │  │ pgvector Extension             │ │ │  │ Incident/Change Relationships  │ │    │
│  │  │ • incident_embeddings          │ │ │  │ • CAUSED_BY edges              │ │    │
│  │  │ • resolution_embeddings        │ │ │  │ • RESOLVED_BY edges            │ │    │
│  │  │ • knowledge_embeddings         │ │ │  │ • CHANGED edges                │ │    │
│  │  └────────────────────────────────┘ │ │  └────────────────────────────────┘ │    │
│  └─────────────────────────────────────┘ └─────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                          ▲
                                          │
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              DATA PIPELINE LAYER                                     │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                           Apache Airflow                                     │    │
│  │  ┌────────────────┐ ┌────────────────┐ ┌────────────────┐ ┌──────────────┐  │    │
│  │  │ CSV Ingestion  │ │ Graph Sync     │ │ Embedding      │ │ Anomaly      │  │    │
│  │  │ DAG            │ │ DAG            │ │ Generation DAG │ │ Detection DAG│  │    │
│  │  │ ────────────   │ │ ────────       │ │ ──────────     │ │ ─────────    │  │    │
│  │  │ Daily @ 2 AM   │ │ Daily @ 3 AM   │ │ Daily @ 4 AM   │ │ Hourly       │  │    │
│  │  └────────────────┘ └────────────────┘ └────────────────┘ └──────────────┘  │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                          ▲
                                          │
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                  DATA SOURCES                                        │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐               │
│  │ incidents    │ │ problems     │ │ changes      │ │ config_items │               │
│  │ .csv         │ │ .csv         │ │ .csv         │ │ .csv         │               │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘               │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐               │
│  │ services     │ │ ci_relations │ │ metrics      │ │ resolutions  │               │
│  │ .csv         │ │ .csv         │ │ .csv         │ │ .csv         │               │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘               │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. Process Workflow Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                        INFRASIGHT-AI PROCESS WORKFLOW                                │
└─────────────────────────────────────────────────────────────────────────────────────┘

╔═══════════════════════════════════════════════════════════════════════════════════╗
║  PHASE 1: DATA INGESTION & PREPARATION                                             ║
╚═══════════════════════════════════════════════════════════════════════════════════╝

    ┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
    │ CSV Files   │────▶│  Airflow    │────▶│  Validate   │────▶│  Transform  │
    │ (8 sources) │     │  Trigger    │     │  & Clean    │     │  & Enrich   │
    └─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘
                                                                       │
                        ┌──────────────────────────────────────────────┴──────────┐
                        │                                                          │
                        ▼                                                          ▼
                ┌───────────────┐                                      ┌───────────────┐
                │  PostgreSQL   │                                      │    Neo4j      │
                │  Load Tables  │                                      │  Create Nodes │
                │  ───────────  │                                      │  & Relations  │
                │  • incidents  │                                      │  ────────────  │
                │  • problems   │                                      │  • CI nodes   │
                │  • changes    │                                      │  • DEPENDS_ON │
                │  • CIs        │                                      │  • AFFECTS    │
                │  • services   │                                      │  • HOSTS      │
                └───────────────┘                                      └───────────────┘

╔═══════════════════════════════════════════════════════════════════════════════════╗
║  PHASE 2: EMBEDDING GENERATION & VECTOR INDEXING                                   ║
╚═══════════════════════════════════════════════════════════════════════════════════╝

    ┌───────────────────┐     ┌───────────────────┐     ┌───────────────────┐
    │  Fetch Records    │────▶│  Generate Text    │────▶│  Sentence         │
    │  from PostgreSQL  │     │  Representations  │     │  Transformers     │
    │                   │     │  (title + desc +  │     │  Embedding Model  │
    │                   │     │   resolution)     │     │                   │
    └───────────────────┘     └───────────────────┘     └───────────────────┘
                                                               │
                                                               ▼
                                                    ┌───────────────────┐
                                                    │  Store Vectors    │
                                                    │  in pgvector      │
                                                    │  ──────────────   │
                                                    │  768-dim vectors  │
                                                    │  cosine index     │
                                                    └───────────────────┘

╔═══════════════════════════════════════════════════════════════════════════════════╗
║  PHASE 3: GRAPH ANALYTICS PIPELINE                                                 ║
╚═══════════════════════════════════════════════════════════════════════════════════╝

    ┌────────────────────────────────────────────────────────────────────────────┐
    │                         Neo4j Graph Processing                              │
    │                                                                             │
    │  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐                  │
    │  │ Dependency   │    │ Centrality   │    │ Community    │                  │
    │  │ Analysis     │    │ Computation  │    │ Detection    │                  │
    │  │ ──────────   │    │ ────────────│    │ ─────────    │                  │
    │  │ Find paths   │    │ PageRank    │    │ Louvain      │                  │
    │  │ between CIs  │    │ Betweenness │    │ algorithm    │                  │
    │  └──────────────┘    └──────────────┘    └──────────────┘                  │
    │         │                   │                   │                           │
    │         └───────────────────┼───────────────────┘                           │
    │                             ▼                                               │
    │                    ┌──────────────┐                                         │
    │                    │ Store Graph  │                                         │
    │                    │ Metrics      │                                         │
    │                    │ ───────────  │                                         │
    │                    │ • risk_score │                                         │
    │                    │ • centrality │                                         │
    │                    │ • blast_rad  │                                         │
    │                    └──────────────┘                                         │
    └────────────────────────────────────────────────────────────────────────────┘

╔═══════════════════════════════════════════════════════════════════════════════════╗
║  PHASE 4: USER INTERACTION WORKFLOWS                                               ║
╚═══════════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────────────┐
│  WORKFLOW A: ROOT CAUSE ANALYSIS                                                    │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│  ┌──────────┐   ┌───────────┐   ┌───────────┐   ┌───────────┐   ┌──────────────┐  │
│  │ Incident │──▶│ RCA Agent │──▶│ Neo4j     │──▶│ Traverse  │──▶│ Identify     │  │
│  │ Input    │   │ Activated │   │ Query     │   │ Deps      │   │ Root Cause   │  │
│  └──────────┘   └───────────┘   └───────────┘   └───────────┘   └──────────────┘  │
│                                                                        │           │
│                                                                        ▼           │
│  ┌──────────────────────────────────────────────────────────────────────────────┐ │
│  │                              BLAST RADIUS CALCULATION                         │ │
│  │  ┌────────────┐   ┌────────────┐   ┌────────────┐   ┌────────────────────┐   │ │
│  │  │ Get CI     │──▶│ Find All   │──▶│ Calculate  │──▶│ Return Affected    │   │ │
│  │  │ from Graph │   │ Downstream │   │ Impact     │   │ Services + Risk    │   │ │
│  │  │            │   │ Dependents │   │ Scores     │   │                    │   │ │
│  │  └────────────┘   └────────────┘   └────────────┘   └────────────────────┘   │ │
│  └──────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│  WORKFLOW B: CHANGE RISK ASSESSMENT                                                 │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│  ┌──────────────┐   ┌───────────────┐   ┌────────────────────────────────────────┐ │
│  │ Change       │──▶│ Change Risk   │──▶│ RISK SCORING ALGORITHM                 │ │
│  │ Request      │   │ Agent         │   │ ────────────────────────               │ │
│  │ Input        │   │ Activated     │   │                                        │ │
│  └──────────────┘   └───────────────┘   │  risk = (centrality × 0.3) +          │ │
│                                          │          (downstream_count × 0.25) +   │ │
│                                          │          (historical_failures × 0.25) +│ │
│                                          │          (change_complexity × 0.2)     │ │
│                                          │                                        │ │
│                                          │  Classification:                       │ │
│                                          │  • LOW:    risk < 0.3                  │ │
│                                          │  • MEDIUM: 0.3 ≤ risk < 0.7           │ │
│                                          │  • HIGH:   risk ≥ 0.7                 │ │
│                                          └────────────────────────────────────────┘ │
│                                                         │                           │
│                                                         ▼                           │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │  Output: Risk Classification + Justification + Recommended Approval Workflow │  │
│  └──────────────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│  WORKFLOW C: REMEDIATION RECOMMENDATION                                             │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│  ┌──────────┐   ┌────────────┐   ┌────────────┐   ┌────────────┐   ┌────────────┐ │
│  │ Incident │──▶│ Embed      │──▶│ Vector     │──▶│ Retrieve   │──▶│ Build      │ │
│  │ Details  │   │ Query      │   │ Similarity │   │ Top-K      │   │ Context    │ │
│  └──────────┘   └────────────┘   │ Search     │   │ Similar    │   └────────────┘ │
│                                   │ (pgvector) │   │ Incidents  │        │         │
│                                   └────────────┘   └────────────┘        │         │
│                                                                           ▼         │
│  ┌──────────────────────────────────────────────────────────────────────────────┐ │
│  │                        RAG + LLM PROCESSING                                   │ │
│  │  ┌─────────────────┐   ┌─────────────────┐   ┌─────────────────────────────┐ │ │
│  │  │ Combine:        │──▶│ Llama 3.2       │──▶│ Generate:                   │ │ │
│  │  │ • Graph Context │   │ (via Ollama)    │   │ • Recommended Fix           │ │ │
│  │  │ • Similar Cases │   │ Reasoning       │   │ • Workarounds               │ │ │
│  │  │ • CI Metadata   │   │                 │   │ • Preventive Actions        │ │ │
│  │  └─────────────────┘   └─────────────────┘   └─────────────────────────────┘ │ │
│  └──────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────┘

╔═══════════════════════════════════════════════════════════════════════════════════╗
║  PHASE 5: PROACTIVE DETECTION WORKFLOWS                                            ║
╚═══════════════════════════════════════════════════════════════════════════════════╝

┌──────────────────────────────────────────┐  ┌──────────────────────────────────────┐
│  ORPHAN/ZOMBIE DETECTION                  │  │  ANOMALY & DRIFT DETECTION            │
├──────────────────────────────────────────┤  ├──────────────────────────────────────┤
│                                           │  │                                       │
│  ┌─────────────┐                         │  │  ┌─────────────┐                      │
│  │ Scheduled   │                         │  │  │ Hourly      │                      │
│  │ Daily Run   │                         │  │  │ Trigger     │                      │
│  └──────┬──────┘                         │  │  └──────┬──────┘                      │
│         │                                 │  │         │                             │
│         ▼                                 │  │         ▼                             │
│  ┌─────────────────────────────────────┐ │  │  ┌─────────────────────────────────┐  │
│  │ Cypher Query:                       │ │  │  │ Compare:                        │  │
│  │ MATCH (ci:CI)                       │ │  │  │ • Current graph snapshot        │  │
│  │ WHERE NOT (ci)-[:DEPENDS_ON]-()     │ │  │  │ • Historical baseline           │  │
│  │ AND NOT ()-[:DEPENDS_ON]->(ci)      │ │  │  │                                 │  │
│  │ RETURN ci                           │ │  │  │ Detect:                         │  │
│  └─────────────────────────────────────┘ │  │  │ • New/removed dependencies      │  │
│         │                                 │  │  │ • Config property changes       │  │
│         ▼                                 │  │  │ • Unusual patterns              │  │
│  ┌─────────────────────────────────────┐ │  │  └─────────────────────────────────┘  │
│  │ Cross-reference with:               │ │  │         │                             │
│  │ • Usage metrics (low traffic)       │ │  │         ▼                             │
│  │ • Cost data (high cost)             │ │  │  ┌─────────────────────────────────┐  │
│  │ • Last incident date                │ │  │  │ Alert if anomaly_score > 0.7   │  │
│  └─────────────────────────────────────┘ │  │  └─────────────────────────────────┘  │
│         │                                 │  │                                       │
│         ▼                                 │  │                                       │
│  ┌─────────────────────────────────────┐ │  │                                       │
│  │ Output: Orphan Report with          │ │  │                                       │
│  │ recommendations                     │ │  │                                       │
│  └─────────────────────────────────────┘ │  │                                       │
└──────────────────────────────────────────┘  └──────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│  CAPACITY PREDICTION                                                                 │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│  ┌──────────────┐   ┌──────────────┐   ┌──────────────┐   ┌──────────────────────┐ │
│  │ Historical   │──▶│ Time Series  │──▶│ Trend        │──▶│ Predict Saturation   │ │
│  │ Metrics      │   │ Analysis     │   │ Extrapolation│   │ Date                 │ │
│  │ (30 days)    │   │              │   │              │   │                      │ │
│  └──────────────┘   └──────────────┘   └──────────────┘   └──────────────────────┘ │
│                                                                    │                │
│                                                                    ▼                │
│  ┌──────────────────────────────────────────────────────────────────────────────┐  │
│  │  Output: CIs predicted to reach capacity within 7/14/30 days                  │  │
│  │          with recommended scaling actions                                      │  │
│  └──────────────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. Data Model Overview

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              UNIFIED DATA MODEL                                      │
└─────────────────────────────────────────────────────────────────────────────────────┘

╔═══════════════════════════════════════════════════════════════════════════════════╗
║                        POSTGRESQL RELATIONAL MODEL                                  ║
╚═══════════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────┐         ┌─────────────────────┐         ┌─────────────────────┐
│      services       │         │   configuration_    │         │     incidents       │
├─────────────────────┤         │       items         │         ├─────────────────────┤
│ PK service_id       │         ├─────────────────────┤         │ PK incident_id      │
│    service_name     │◄────────│ PK ci_id            │────────▶│    title            │
│    service_type     │         │ FK service_id       │         │    description      │
│    criticality      │         │    ci_name          │         │    severity         │
│    owner            │         │    ci_type          │         │    status           │
│    status           │         │    environment      │         │    priority         │
│    created_at       │         │    status           │         │ FK affected_ci_id   │
│    updated_at       │         │    version          │         │ FK assigned_to      │
└─────────────────────┘         │    ip_address       │         │    created_at       │
                                │    cost_per_month   │         │    resolved_at      │
                                │    last_updated     │         │    resolution_time  │
                                └─────────────────────┘         └─────────────────────┘
                                          │                              │
                                          │                              │
                                          ▼                              ▼
                                ┌─────────────────────┐         ┌─────────────────────┐
                                │   ci_relationships  │         │    resolutions      │
                                ├─────────────────────┤         ├─────────────────────┤
                                │ PK relationship_id  │         │ PK resolution_id    │
                                │ FK source_ci_id     │         │ FK incident_id      │
                                │ FK target_ci_id     │         │    resolution_type  │
                                │    relationship_type│         │    description      │
                                │    created_at       │         │    root_cause       │
                                └─────────────────────┘         │    fix_applied      │
                                                                │    workaround       │
┌─────────────────────┐         ┌─────────────────────┐         │    preventive_action│
│      problems       │         │      changes        │         │    created_at       │
├─────────────────────┤         ├─────────────────────┤         └─────────────────────┘
│ PK problem_id       │         │ PK change_id        │
│    title            │         │    title            │         ┌─────────────────────┐
│    description      │         │    description      │         │   metrics_usage     │
│    status           │         │    change_type      │         ├─────────────────────┤
│    priority         │         │    status           │         │ PK metric_id        │
│    root_cause       │         │    risk_level       │         │ FK ci_id            │
│ FK related_incidents│         │ FK affected_ci_id   │         │    metric_type      │
│    known_error      │         │    scheduled_start  │         │    metric_value     │
│    workaround       │         │    scheduled_end    │         │    unit             │
│    created_at       │         │    actual_start     │         │    timestamp        │
│    resolved_at      │         │    actual_end       │         │    threshold        │
└─────────────────────┘         │    implemented_by   │         └─────────────────────┘
                                │    approved_by      │
                                │    created_at       │         ┌─────────────────────┐
                                └─────────────────────┘         │  incident_embeddings│
                                                                ├─────────────────────┤
                                                                │ FK incident_id      │
                                                                │    embedding (768)  │
                                                                │    text_content     │
                                                                │    created_at       │
                                                                └─────────────────────┘

╔═══════════════════════════════════════════════════════════════════════════════════╗
║                           NEO4J GRAPH MODEL                                         ║
╚═══════════════════════════════════════════════════════════════════════════════════╝

                    ┌───────────────────────────────────────────┐
                    │              :Service                      │
                    │  ┌─────────────────────────────────────┐  │
                    │  │ service_id: STRING                  │  │
                    │  │ name: STRING                        │  │
                    │  │ type: STRING                        │  │
                    │  │ criticality: STRING                 │  │
                    │  │ owner: STRING                       │  │
                    │  │ status: STRING                      │  │
                    │  └─────────────────────────────────────┘  │
                    └───────────────────────────────────────────┘
                                        │
                                        │ :PROVIDES
                                        ▼
┌───────────────────────────────────────────────────────────────────────────────────┐
│                            :ConfigurationItem                                      │
│  ┌─────────────────────────────────────────────────────────────────────────────┐  │
│  │ ci_id: STRING              │ environment: STRING    │ cost_per_month: FLOAT │  │
│  │ name: STRING               │ ip_address: STRING     │ centrality_score: FLOAT│  │
│  │ type: STRING               │ version: STRING        │ risk_score: FLOAT     │  │
│  │ status: STRING             │ last_updated: DATETIME │ blast_radius: INTEGER │  │
│  └─────────────────────────────────────────────────────────────────────────────┘  │
└───────────────────────────────────────────────────────────────────────────────────┘
          │                    │                    │                    │
          │:DEPENDS_ON         │:HOSTS              │:CONNECTS_TO        │:RUNS_ON
          ▼                    ▼                    ▼                    ▼
    ┌──────────┐         ┌──────────┐         ┌──────────┐         ┌──────────┐
    │   :CI    │         │   :CI    │         │   :CI    │         │   :CI    │
    │(Database)│         │ (Server) │         │ (Network)│         │ (Cloud)  │
    └──────────┘         └──────────┘         └──────────┘         └──────────┘

┌───────────────────────────────────────────────────────────────────────────────────┐
│                              :Incident                                             │
│  ┌─────────────────────────────────────────────────────────────────────────────┐  │
│  │ incident_id: STRING        │ status: STRING        │ resolution_time: INT   │  │
│  │ title: STRING              │ priority: STRING      │ created_at: DATETIME   │  │
│  │ severity: STRING           │                       │ resolved_at: DATETIME  │  │
│  └─────────────────────────────────────────────────────────────────────────────┘  │
└───────────────────────────────────────────────────────────────────────────────────┘
          │                              │                              │
          │:AFFECTS                      │:CAUSED_BY                    │:RESOLVED_BY
          ▼                              ▼                              ▼
    ┌──────────┐                   ┌──────────┐                   ┌──────────┐
    │   :CI    │                   │   :CI    │                   │:Resolution│
    └──────────┘                   └──────────┘                   └──────────┘

┌───────────────────────────────────────────────────────────────────────────────────┐
│                                :Change                                             │
│  ┌─────────────────────────────────────────────────────────────────────────────┐  │
│  │ change_id: STRING          │ status: STRING        │ risk_level: STRING     │  │
│  │ title: STRING              │ change_type: STRING   │ scheduled_start: DT    │  │
│  │ risk_score: FLOAT          │ implemented_by: STR   │ scheduled_end: DT      │  │
│  └─────────────────────────────────────────────────────────────────────────────┘  │
└───────────────────────────────────────────────────────────────────────────────────┘
          │                              │
          │:MODIFIES                     │:TRIGGERS
          ▼                              ▼
    ┌──────────┐                   ┌──────────┐
    │   :CI    │                   │:Incident │
    └──────────┘                   └──────────┘

                    RELATIONSHIP TYPES
    ┌───────────────────────────────────────────────────────────────────┐
    │  (:Service)-[:PROVIDES]->(:CI)                                   │
    │  (:CI)-[:DEPENDS_ON {strength: FLOAT}]->(:CI)                    │
    │  (:CI)-[:HOSTS]->(:CI)                                           │
    │  (:CI)-[:CONNECTS_TO {protocol: STRING, port: INT}]->(:CI)       │
    │  (:CI)-[:RUNS_ON]->(:CI)                                         │
    │  (:Incident)-[:AFFECTS]->(:CI)                                   │
    │  (:Incident)-[:CAUSED_BY]->(:CI)                                 │
    │  (:Incident)-[:RESOLVED_BY]->(:Resolution)                       │
    │  (:Change)-[:MODIFIES]->(:CI)                                    │
    │  (:Change)-[:TRIGGERS]->(:Incident)                              │
    │  (:Problem)-[:RELATES_TO]->(:Incident)                           │
    │  (:Problem)-[:ROOT_CAUSE]->(:CI)                                 │
    └───────────────────────────────────────────────────────────────────┘
```

---

## 4. Component Integration Flow

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                         COMPONENT INTEGRATION FLOW                                   │
└─────────────────────────────────────────────────────────────────────────────────────┘

    User Request (via Gradio UI)
              │
              ▼
    ┌─────────────────────┐
    │   Request Router    │
    └─────────────────────┘
              │
    ┌─────────┼─────────┬─────────────────────────────────┐
    │         │         │                                 │
    ▼         ▼         ▼                                 ▼
┌───────┐ ┌───────┐ ┌───────┐                      ┌───────────┐
│  RCA  │ │Change │ │Remed- │                      │ Analytics │
│ Agent │ │ Risk  │ │iation │                      │  Queries  │
│       │ │ Agent │ │ Agent │                      │           │
└───────┘ └───────┘ └───────┘                      └───────────┘
    │         │         │                                 │
    │         │         │                                 │
    ▼         ▼         ▼                                 │
┌─────────────────────────────────────────┐               │
│         Tool Execution Layer            │               │
│  ┌──────────┐ ┌──────────┐ ┌─────────┐ │               │
│  │Neo4j Tool│ │RAG Tool  │ │Calc Tool│ │               │
│  └──────────┘ └──────────┘ └─────────┘ │               │
└─────────────────────────────────────────┘               │
         │              │           │                     │
         ▼              ▼           │                     │
    ┌─────────┐    ┌─────────┐      │                     │
    │  Neo4j  │    │PostgreSQL│     │                     │
    │  Graph  │    │+ pgvector│     │                     │
    └─────────┘    └─────────┘      │                     │
         │              │           │                     │
         └──────────────┴───────────┴─────────────────────┘
                        │
                        ▼
              ┌─────────────────────┐
              │    Llama 3.2        │
              │    (via Ollama)     │
              └─────────────────────┘
                        │
                        ▼
              ┌─────────────────────┐
              │   Response Builder  │
              └─────────────────────┘
                        │
                        ▼
              ┌─────────────────────┐
              │   Gradio UI Output  │
              └─────────────────────┘
```

---

## 5. Technology Stack Summary

| Layer | Technology | Purpose |
|-------|------------|---------|
| **UI** | Gradio | Interactive web interface |
| **AI/ML** | LangChain | Agent orchestration |
| **LLM** | Llama 3.2 (Ollama) | Local inference |
| **Embeddings** | sentence-transformers | Vector generation |
| **Vector DB** | PostgreSQL + pgvector | Similarity search |
| **Graph DB** | Neo4j | Dependency analysis |
| **Relational DB** | PostgreSQL 15 | Structured data |
| **Orchestration** | Apache Airflow | Data pipelines |
| **Language** | Python 3.10+ | Implementation |

